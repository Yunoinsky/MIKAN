#include "tetris.h"

uint8_t matrix[MATRIX_H][MATRIX_W];

tetro_type TETRO[7] = {
    {
        // O
        .bbsize = 2,
        .mino = {{{0, 0}, {0, 1}, {1, 0}, {1, 1}}},
        .rot = {
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
        }
    }, {
        // I
        .bbsize = 4,
        .mino = {{{2, 0}, {2, 1}, {2, 2}, {2, 3}}},
        .rot = {
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
        }
    }, {
        // T
        .bbsize = 3,
        .mino = {{{1, 0}, {1, 1}, {1, 2}, {2, 1}}},
        .rot = {
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
        }
    }, {
        // L
        .bbsize = 3,
        .mino = {{{1, 0}, {1, 1}, {1, 2}, {2, 2}}},
        .rot = {
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
        }
    }, {
        // J
        .bbsize = 3,
        .mino = {{{1, 0}, {1, 1}, {1, 2}, {2, 0}}},
        .rot = {
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
        }
    }, {
        // S
        .bbsize = 3,
        .mino = {{{1, 0}, {1, 1}, {2, 1}, {2, 2}}},
        .rot = {
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
        }
    }, {
        // Z
        .bbsize = 3,
        .mino = {{{1, 1}, {1, 2}, {2, 0}, {2, 1}}},
        .rot = {
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
            {{0, 0}, {0, 0}, {0, 0}, {0, 0}, {0, 0}},
        }
    }
};

void tetro_init()
{
    for (uint8_t i = 0; i < 7; i++) {
        uint8_t s = TETRO[i].bbsize;
#define m   TETRO[i].mino
        for (uint8_t j = 0; j < 4; j++) {
            uint8_t x = m[0][j][0];
            uint8_t y = m[0][j][1];
            m[1][j][0] = y;
            m[1][j][1] = x;
            m[2][j][0] = s - 1 - x;
            m[2][j][1] = s - 1 - y;
            m[3][j][0] = s - 1 - y;
            m[3][j][1] = s - 1 - x;
        }
        /*for (uint8_t j = 0; j < 4; j++) {
            printf("Tetrimino %u rotation %u:", i, j);
            for (uint8_t k = 0; k < 4; k++)
                printf(" (%u %u)", m[j][k][0], m[j][k][1]);
            putchar('\n');
        }*/
    }
};
